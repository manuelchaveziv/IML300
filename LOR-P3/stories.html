<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stories - Legacy of Resilience</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <link rel="stylesheet" href="Project3.css" />
    
</head>
<body>
     <nav>
        <ul>
            <li><a href="index.html" class="active">Home</a></li>
            <li><a href="stories.html">Stories</a></li>
            <li><a href="submitstory.html">Share Your Story</a></li>
            <li><a href="resources.html">Resources</a></li>
            <li><a href="about.html">About</a></li>
        </ul>
    </nav>

    <header>
        <h1>Stories of Resilience</h1>
    </header>

    <main>

        <div class="stories-grid" id="storiesGrid">
        </div>
    </main>

    <script>
       const firebaseConfig = {
  apiKey: "AIzaSyDMr7mtdM69OJFaROO6zUYj0YaysibP2E4",
  authDomain: "project3-legacy.firebaseapp.com",
  databaseURL: "https://project3-legacy-default-rtdb.firebaseio.com",
  projectId: "project3-legacy",
  storageBucket: "project3-legacy.firebasestorage.app",
  messagingSenderId: "805209453944",
  appId: "1:805209453944:web:50537951ee7335f4ad448d",
  measurementId: "G-N3PK0JE775"
};

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        $(document).ready(function() {
            var allStories = [];
            
            function createStoryCard(story) {
                var title = story.ancestorName || story.name + "'s Story";
                var countryDisplay = story.country ? story.country + " → USA" : "Unknown Origin → USA";
                var submittedDate = story.dateSubmitted ? new Date(story.dateSubmitted).toLocaleDateString() : '';
                
                return `
                    <div class="story-item" data-region="${story.region}">
                        <div class="video-placeholder">
                            <p style="color: #999;">[Video: ${title}]</p>
                        </div>
                        <h3>${title}</h3>
                        <p class="story-meta">
                            <span class="story-region">${countryDisplay}</span>
                            <span>Told by: ${story.name}</span>
                        </p>
                        <p>${story.story}</p>
                        ${submittedDate ? '<p style="color: #999; font-size: 0.85em; margin-top: 10px; font-style: italic;">Submitted: ' + submittedDate + '</p>' : ''}
                    </div>
                `;
            }
            
            function loadStories() {
                $('#storiesGrid').html('<p style="text-align: center; color: #666; padding: 40px;">Loading stories...</p>');
                
                database.ref('stories').once('value')
                    .then(function(snapshot) {
                        allStories = [];
                        $('#storiesGrid').empty();
                        
                        snapshot.forEach(function(childSnapshot) {
                            var story = childSnapshot.val();
                            story.id = childSnapshot.key;
                            allStories.push(story);
                        });
                        
                        if (allStories.length === 0) {
                            $('#storiesGrid').html('<p style="text-align: center; color: #666; font-size: 1.2em; padding: 40px;">No stories yet. Be the first to <a href="submit.html" style="color: #cc0000; text-decoration: underline;">share your story</a>!</p>');
                        } else {
                            allStories.forEach(function(story) {
                                $('#storiesGrid').append(createStoryCard(story));
                            });
                            
                            $('.story-item').hide().each(function(index) {
                                $(this).delay(100 * index).fadeIn(600);
                            });
                        }
                    })
                    .catch(function(error) {
                        console.error('Error loading stories:', error);
                        $('#storiesGrid').html('<p style="text-align: center; color: #cc0000; padding: 40px;">Error loading stories. Please refresh the page.</p>');
                    });
            }
            
            loadStories();

            $('.filter-btn').click(function() {
                var filterValue = $(this).data('filter');

                $('.filter-btn').removeClass('active');
                $(this).addClass('active');

                if (filterValue === 'all') {
                    $('.story-item').fadeIn(400);
                } else {
                    $('.story-item').hide();
                    $('.story-item[data-region="' + filterValue + '"]').fadeIn(400);
                }
            });
        });
    </script>
</body>
</html>